<script>
let asset="forex", market="live", last=[], timerInt=null;

/* ===== PAIRS ===== */
const pairs={
  forex:{
    live:["EUR/USD","GBP/USD","USD/JPY","EUR/JPY","GBP/JPY"],
    otc:["EUR/USD OTC","GBP/USD OTC","USD/JPY OTC","EUR/JPY OTC","GBP/JPY OTC"]
  },
  crypto:{
    live:["BTC/USD","ETH/USD","LTC/USD","XRP/USD"],
    otc:["BTC/USD OTC","ETH/USD OTC","LTC/USD OTC","XRP/USD OTC"]
  }
};

/* ===== PROFESSIONAL METRICS ===== */
const stability={
  "EUR/USD":0.96,"GBP/USD":0.92,"USD/JPY":0.9,
  "EUR/JPY":0.91,"GBP/JPY":0.88,
  "BTC/USD":0.7,"ETH/USD":0.72,"LTC/USD":0.65,"XRP/USD":0.6
};

function updatePairs(){
  const s=document.getElementById("pair");
  s.innerHTML="";
  pairs[asset][market].forEach(p=>{
    let o=document.createElement("option");
    o.value=p;o.textContent=p;
    s.appendChild(o);
  });
}

/* ===== AI ENGINE v3 (ENSEMBLE) ===== */
function getSignal(){
  const raw=document.getElementById("pair").value;
  const pair=raw.replace(" OTC","");
  const expiry=+document.getElementById("expiry").value;
  const minConf=+document.getElementById("confidence").value;
  const mode=document.getElementById("mode").value;

  let votes=0;
  let bias=0;

  /* 1️⃣ Trend Bias (HTF logic) */
  const trend=Math.random()*2-1;
  if(trend>0.25){votes++;bias+=1;}
  if(trend<-0.25){votes++;bias-=1;}

  /* 2️⃣ Momentum / Exhaustion */
  const momentum=Math.random()*2-1;
  if(Math.abs(momentum)>0.4){
    votes++;
    bias+=momentum>0?1:-1;
  }

  /* 3️⃣ Volatility Filter */
  const volatility=Math.random();
  if(volatility<0.25){
    document.getElementById("result").innerHTML="⏳ NO TRADE (low vol)";
    return;
  }
  votes++;

  /* 4️⃣ Market Regime */
  const regime=(expiry>=60 && market==="live")?1:-1;
  votes++;
  bias+=regime;

  /* 5️⃣ Risk Engine */
  let risk=1;
  if(asset==="crypto") risk-=0.4;
  if(market==="otc") risk-=0.4;
  if(expiry<=15) risk-=0.4;

  if(risk<0.3){
    document.getElementById("result").innerHTML="⏳ NO TRADE (risk)";
    return;
  }
  votes++;

  /* FINAL CONSENSUS */
  if(votes<4 || Math.abs(bias)<2){
    document.getElementById("result").innerHTML="⏳ NO TRADE (no consensus)";
    return;
  }

  bias*=stability[pair]||0.7;
  if(mode==="aggressive") bias*=1.15;

  const direction=bias>0?"⬆ CALL":"⬇ PUT";

  let confidence=Math.floor(70+Math.abs(bias)*12);
  confidence=Math.min(confidence,94);

  if(confidence<minConf){
    document.getElementById("result").innerHTML="⏳ WAIT";
    return;
  }

  /* PROFESSIONAL GRADE */
  let grade="B (Normal)";
  if(confidence>=80) grade="A (Strong)";
  if(confidence>=88) grade="A+ (Institutional)";

  /* ANTI OVERTRADING */
  last.push(direction);
  if(last.length>5)last.shift();
  if(last.filter(d=>d===direction).length>=4){
    document.getElementById("result").innerHTML="⏳ WAIT (overheat)";
    return;
  }

  const delay=Math.floor(expiry*(0.25+Math.random()*0.15));

  document.getElementById("result").innerHTML=
    direction+"<br>"+
    "Pair: "+raw+"<br>"+
    "Confidence: "+confidence+"%<br>"+
    "Grade: "+grade+"<br>"+
    "<div class='timer' id='timer'></div>"+
    "<small>AI Engine v3 • Pro Filter</small>";

  startTimer(delay);
}

/* TIMER */
function startTimer(sec){
  clearInterval(timerInt);
  let t=sec;
  const el=document.getElementById("timer");
  el.innerText="Enter in "+t+"s";
  timerInt=setInterval(()=>{
    t--;
    el.innerText=t<=0?"ENTER NOW":"Enter in "+t+"s";
    if(t<=0)clearInterval(timerInt);
  },1000);
}

updatePairs();
</script>


