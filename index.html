<script>
let asset="forex", market="live", last=[], timerInt=null;

/* PAIRS */
const pairs={
  forex:{
    live:["EUR/USD","GBP/USD","USD/JPY","EUR/JPY","GBP/JPY"],
    otc:["EUR/USD OTC","GBP/USD OTC","USD/JPY OTC","EUR/JPY OTC","GBP/JPY OTC"]
  },
  crypto:{
    live:["BTC/USD","ETH/USD","LTC/USD","XRP/USD"],
    otc:["BTC/USD OTC","ETH/USD OTC","LTC/USD OTC","XRP/USD OTC"]
  }
};

/* STABILITY INDEX (0–1) */
const stability={
  "EUR/USD":0.95,"GBP/USD":0.9,"USD/JPY":0.88,
  "EUR/JPY":0.9,"GBP/JPY":0.85,
  "BTC/USD":0.65,"ETH/USD":0.7,"LTC/USD":0.6,"XRP/USD":0.55
};

function updatePairs(){
  const s=document.getElementById("pair");
  s.innerHTML="";
  pairs[asset][market].forEach(p=>{
    let o=document.createElement("option");
    o.value=p;o.textContent=p;
    s.appendChild(o);
  });
}

/* === AI ENGINE v2 === */
function getSignal(){
  const pairRaw=document.getElementById("pair").value;
  const pair=pairRaw.replace(" OTC","");
  const expiry=+document.getElementById("expiry").value;
  const minConf=+document.getElementById("confidence").value;
  const mode=document.getElementById("mode").value;

  /* --- FILTER 1: bad conditions --- */
  if(expiry<=15 && asset==="crypto"){
    result.innerHTML="⏳ WAIT (noise)";
    return;
  }

  let score=0;

  /* --- TIMEFRAME CONFIRMATION --- */
  if(expiry===30) score+=1;
  if(expiry>=60) score+=2;
  if(expiry>=120) score+=3;

  /* --- MARKET QUALITY --- */
  score += market==="live" ? 2 : -1;

  /* --- ASSET TYPE --- */
  score += asset==="forex" ? 2 : -1;

  /* --- STABILITY --- */
  score *= stability[pair] || 0.7;

  /* --- MOMENTUM SIMULATION --- */
  const momentum=(Math.random()*2-1);
  const trend=(Math.random()*2-1)*0.5;
  const pullback=(Math.random()*2-1)*0.3;

  const marketState=momentum+trend-pullback;
  score+=marketState;

  /* --- MODE --- */
  if(mode==="aggressive") score*=1.15;
  else score*=0.9;

  /* --- FINAL DECISION --- */
  if(Math.abs(score)<1.2){
    result.innerHTML="⏳ WAIT (no edge)";
    return;
  }

  const direction=score>0?"⬆ CALL":"⬇ PUT";

  /* --- CONFIDENCE --- */
  let confidence=Math.floor(65+Math.abs(score)*10);
  confidence=Math.min(confidence,92);

  if(confidence<minConf){
    result.innerHTML="⏳ WAIT";
    return;
  }

  /* --- ANTI OVERTRADING --- */
  last.push(direction);
  if(last.length>5)last.shift();
  if(last.filter(d=>d===direction).length>=4){
    result.innerHTML="⏳ WAIT (overheat)";
    return;
  }

  /* --- EFFICIENCY LABEL --- */
  let efficiency="MEDIUM";
  if(confidence>=85 && score>2) efficiency="HIGH";
  if(confidence<75) efficiency="LOW";

  /* --- ENTRY TIMER --- */
  const delay=Math.floor(expiry*(0.25+Math.random()*0.15));

  result.innerHTML=
    direction+"<br>"+
    "Pair: "+pairRaw+"<br>"+
    "Confidence: "+confidence+"%<br>"+
    "Efficiency: "+efficiency+"<br>"+
    "<div class='timer' id='timer'></div>"+
    "<small>AI Engine v2.0</small>";

  startTimer(delay);
}

/* TIMER */
function startTimer(sec){
  clearInterval(timerInt);
  let t=sec;
  const el=document.getElementById("timer");
  el.innerText="Enter in "+t+"s";
  timerInt=setInterval(()=>{
    t--;
    el.innerText=t<=0?"ENTER NOW":"Enter in "+t+"s";
    if(t<=0)clearInterval(timerInt);
  },1000);
}

updatePairs();
</script>

